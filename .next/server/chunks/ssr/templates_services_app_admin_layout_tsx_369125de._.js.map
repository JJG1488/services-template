{"version":3,"sources":["../../../../../../templates/services/app/admin/layout.tsx","../../../../../../templates/services/lib/admin-context.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { Menu, X } from \"lucide-react\";\nimport { AdminContext } from \"@/lib/admin-context\";\n\nfunction LoginForm({ onLogin }: { onLogin: (password: string) => Promise<boolean> }) {\n  const [password, setPassword] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setError(\"\");\n    setLoading(true);\n\n    const success = await onLogin(password);\n    if (!success) {\n      setError(\"Invalid password\");\n    }\n    setLoading(false);\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\n      <div className=\"bg-white p-8 rounded-lg shadow-md w-full max-w-md\">\n        <h1 className=\"text-2xl font-bold mb-6 text-center\">Admin Login</h1>\n        <form onSubmit={handleSubmit}>\n          <div className=\"mb-4\">\n            <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Password\n            </label>\n            <input\n              id=\"password\"\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              placeholder=\"Enter admin password\"\n              className=\"w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-brand\"\n              autoFocus\n            />\n          </div>\n          {error && (\n            <div className=\"text-sm mb-4 p-3 rounded-lg bg-red-50 border border-red-200\">\n              <p className=\"text-red-600\">{error}</p>\n            </div>\n          )}\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full bg-brand text-gray-900 font-semibold py-3 rounded-lg hover:bg-brand-dark disabled:opacity-50 transition-colors\"\n          >\n            {loading ? \"Verifying...\" : \"Login\"}\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n}\n\ninterface EnabledFeatures {\n  menuSystem: boolean;\n  bookingSystem: boolean;\n  portfolioGallery: boolean;\n  quoteRequests: boolean;\n  testimonials: boolean;\n  teamMembers: boolean;\n  faqSection: boolean;\n}\n\nfunction AdminNav({ onLogout }: { onLogout: () => void }) {\n  const pathname = usePathname();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [enabledFeatures, setEnabledFeatures] = useState<EnabledFeatures | null>(null);\n\n  useEffect(() => {\n    setMobileMenuOpen(false);\n  }, [pathname]);\n\n  // Fetch enabled features on mount\n  useEffect(() => {\n    async function fetchSettings() {\n      try {\n        const token = localStorage.getItem(\"admin_token\");\n        const res = await fetch(\"/api/admin/settings\", {\n          headers: { Authorization: \"Bearer \" + token },\n          cache: \"no-store\",\n        });\n        if (res.ok) {\n          const data = await res.json();\n          if (data.settings?.enabledFeatures) {\n            setEnabledFeatures(data.settings.enabledFeatures);\n          }\n        }\n      } catch (err) {\n        console.error(\"Error fetching settings for nav:\", err);\n      }\n    }\n    fetchSettings();\n  }, []);\n\n  // All possible nav links with feature requirements\n  const allLinks = [\n    { href: \"/admin\", label: \"Dashboard\", always: true },\n    { href: \"/admin/services\", label: \"Services\", always: true },\n    { href: \"/admin/portfolio\", label: \"Portfolio\", feature: \"portfolioGallery\" as keyof EnabledFeatures },\n    { href: \"/admin/menu\", label: \"Menu\", feature: \"menuSystem\" as keyof EnabledFeatures },\n    { href: \"/admin/inquiries\", label: \"Inquiries\", always: true },\n    { href: \"/admin/settings\", label: \"Settings\", always: true },\n  ];\n\n  // Filter links based on enabled features\n  const links = allLinks.filter((link) => {\n    if (link.always) return true;\n    if (!enabledFeatures) return true; // Show all while loading\n    if (link.feature) return enabledFeatures[link.feature];\n    return true;\n  });\n\n  return (\n    <nav className=\"bg-gray-900 text-white\">\n      <div className=\"max-w-6xl mx-auto px-4\">\n        <div className=\"flex items-center justify-between h-16\">\n          <Link href=\"/admin\" className=\"font-bold text-lg\">\n            Admin\n          </Link>\n\n          <div className=\"hidden md:flex items-center gap-6\">\n            {links.map((link) => (\n              <Link\n                key={link.href}\n                href={link.href}\n                className={\"hover:text-gray-300 \" + (\n                  pathname === link.href ? \"text-white font-medium\" : \"text-gray-400\"\n                )}\n              >\n                {link.label}\n              </Link>\n            ))}\n            <Link href=\"/\" className=\"text-gray-400 hover:text-white text-sm\">\n              View Site\n            </Link>\n            <button\n              onClick={onLogout}\n              className=\"text-gray-400 hover:text-white text-sm ml-2 px-3 py-1 border border-gray-600 rounded hover:border-gray-400 transition-colors\"\n            >\n              Sign Out\n            </button>\n          </div>\n\n          <button\n            className=\"md:hidden p-2 text-gray-400 hover:text-white\"\n            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n            aria-label=\"Toggle menu\"\n          >\n            {mobileMenuOpen ? <X className=\"w-6 h-6\" /> : <Menu className=\"w-6 h-6\" />}\n          </button>\n        </div>\n      </div>\n\n      {mobileMenuOpen && (\n        <div className=\"md:hidden border-t border-gray-800\">\n          <div className=\"px-4 py-3 space-y-1\">\n            {links.map((link) => (\n              <Link\n                key={link.href}\n                href={link.href}\n                className={\"block py-2 px-3 rounded-lg \" + (\n                  pathname === link.href\n                    ? \"bg-gray-800 text-white font-medium\"\n                    : \"text-gray-400 hover:bg-gray-800 hover:text-white\"\n                )}\n              >\n                {link.label}\n              </Link>\n            ))}\n            <hr className=\"border-gray-700 my-2\" />\n            <Link\n              href=\"/\"\n              className=\"block py-2 px-3 rounded-lg text-gray-400 hover:bg-gray-800 hover:text-white\"\n            >\n              View Site\n            </Link>\n            <button\n              onClick={onLogout}\n              className=\"block w-full text-left py-2 px-3 rounded-lg text-gray-400 hover:bg-gray-800 hover:text-white\"\n            >\n              Sign Out\n            </button>\n          </div>\n        </div>\n      )}\n    </nav>\n  );\n}\n\nexport default function AdminLayout({ children }: { children: React.ReactNode }) {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [checking, setChecking] = useState(true);\n\n  useEffect(() => {\n    const token = localStorage.getItem(\"admin_token\");\n    if (token) {\n      fetch(\"/api/admin/verify\", {\n        headers: { Authorization: \"Bearer \" + token },\n      })\n        .then((res) => {\n          if (res.ok) setIsAuthenticated(true);\n          else localStorage.removeItem(\"admin_token\");\n        })\n        .catch(() => localStorage.removeItem(\"admin_token\"))\n        .finally(() => setChecking(false));\n    } else {\n      setChecking(false);\n    }\n  }, []);\n\n  async function login(password: string): Promise<boolean> {\n    try {\n      const res = await fetch(\"/api/admin/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ password }),\n      });\n\n      if (res.ok) {\n        const { token } = await res.json();\n        localStorage.setItem(\"admin_token\", token);\n        setIsAuthenticated(true);\n        return true;\n      }\n      return false;\n    } catch {\n      return false;\n    }\n  }\n\n  function logout() {\n    localStorage.removeItem(\"admin_token\");\n    setIsAuthenticated(false);\n  }\n\n  if (checking) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <p>Loading...</p>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return <LoginForm onLogin={login} />;\n  }\n\n  return (\n    <AdminContext.Provider value={{ isAuthenticated, login, logout }}>\n      <div className=\"min-h-screen bg-gray-100\">\n        <AdminNav onLogout={logout} />\n        <main className=\"max-w-6xl mx-auto px-4 py-8\">{children}</main>\n      </div>\n    </AdminContext.Provider>\n  );\n}\n","import { createContext, useContext } from \"react\";\n\ninterface AdminContextType {\n  isAuthenticated: boolean;\n  login: (password: string) => Promise<boolean>;\n  logout: () => void;\n}\n\nexport const AdminContext = createContext<AdminContextType | null>(null);\n\nexport function useAdmin() {\n  const context = useContext(AdminContext);\n  if (!context) {\n    throw new Error(\"useAdmin must be used within AdminContext.Provider\");\n  }\n  return context;\n}\n"],"names":[],"mappings":"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"}